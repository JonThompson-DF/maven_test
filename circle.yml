machine:
  java:
    version: oraclejdk8
  environment:
    DFB_BUILD_ID: $CIRCLE_BUILD_NUM
    DFB_PROJECT_DIR: $(pwd)
    DFB_PRODUCT_NAME: $(basename $DFB_PROJECT_DIR)
    DFB_PRODUCT_KEY: dfb.$DFB_PRODUCT_NAME
    AWS_BUCKET: "external-ci-artifacts"
    DFB_PACKAGING_URL: s3://${AWS_BUCKET}/artifacts/circle/
    JAVA_TOOL_OPTIONS: -javaagent:dfbuild-agent.jar=PACKAGING_BASE_URI=$DFB_PACKAGING_URL,PRODUCT_KEY=$DFB_PRODUCT_KEY/,BUILD_KEY=$DFB_BUILD_ID/,MODULES_KEY=modules/,START_TIME=0,BUILD_BASE_DIR=$DFB_PROJECT_DIR
    AWS_ACCESS_KEY_ID: AKIAIIU2LBOCCKXAIFZQ
    AWS_SECRET_ACCESS_KEY: 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

dependencies:
  pre:
    - wget https://s3.amazonaws.com/external-ci-artifacts/agents/dfbuild-agent.jar
    - wget https://s3.amazonaws.com/external-ci-artifacts/agents/dfbuild-agent-ext.jar

test:
  pre:
    - unset JAVA_TOOL_OPTIONS

#general:
#  artifacts:
#    - "target/my-app-1.0-SNAPSHOT.jar"
